/*! For license information please see dataTables.keyTable.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],(function(t){return e(t,window,document)})):"object"==typeof exports?module.exports=function(t,n){return t||(t=window),n&&n.fn.dataTable||(n=require("datatables.net")(t,n).$),e(n,t,t.document)}:e(jQuery,window,document)}((function(e,t,n,i){"use strict";var s=e.fn.dataTable,o=0,l=0,a=function(t,n){if(!s.versionCheck||!s.versionCheck("1.10.8"))throw"KeyTable requires DataTables 1.10.8 or newer";this.c=e.extend(!0,{},s.defaults.keyTable,a.defaults,n),this.s={dt:new s.Api(t),enable:!0,focusDraw:!1,waitingForDraw:!1,lastFocus:null,namespace:".keyTable-"+o++,tabInput:null},this.dom={};var i=this.s.dt.settings()[0],l=i.keytable;if(l)return l;i.keytable=this,this._constructor()};return e.extend(a.prototype,{blur:function(){this._blur()},enable:function(e){this.s.enable=e},enabled:function(){return this.s.enable},focus:function(e,t){this._focus(this.s.dt.cell(e,t))},focused:function(e){if(!this.s.lastFocus)return!1;var t=this.s.lastFocus.cell.index();return e.row===t.row&&e.column===t.column},_constructor:function(){this._tabInput();var t=this,i=this.s.dt,s=e(i.table().node()),o=this.s.namespace,l=!1;if("static"===s.css("position")&&s.css("position","relative"),e(i.table().body()).on("click"+o,"th, td",(function(e){if(!1!==t.s.enable){var n=i.cell(this);n.any()&&t._focus(n,null,!1,e)}})),e(n).on("keydown"+o,(function(e){l||t._key(e)})),this.c.blurable&&e(n).on("mousedown"+o,(function(n){e(n.target).parents(".dataTables_filter").length&&t._blur(),e(n.target).parents().filter(i.table().container()).length||e(n.target).parents("div.DTE").length||e(n.target).parents("div.editor-datetime").length||e(n.target).parents("div.dt-datetime").length||e(n.target).parents().filter(".DTFC_Cloned").length||t._blur()})),this.c.editor){var a=this.c.editor;a.on("open.keyTableMain",(function(e,n,i){"inline"!==n&&t.s.enable&&(t.enable(!1),a.one("close"+o,(function(){t.enable(!0)})))})),this.c.editOnFocus&&i.on("key-focus"+o+" key-refocus"+o,(function(e,n,i,s){t._editor(null,s,!0)})),i.on("key"+o,(function(e,n,i,s,o){t._editor(i,o,!1)})),e(i.table().body()).on("dblclick"+o,"th, td",(function(e){!1!==t.s.enable&&(i.cell(this).any()&&(t.s.lastFocus&&this!==t.s.lastFocus.cell.node()||t._editor(null,e,!0)))})),a.on("preSubmit",(function(){l=!0})).on("preSubmitCancelled",(function(){l=!1})).on("submitComplete",(function(){l=!1}))}i.settings()[0].oFeatures.bStateSave&&i.on("stateSaveParams"+o,(function(e,n,i){i.keyTable=t.s.lastFocus?t.s.lastFocus.cell.index():null})),i.on("column-visibility"+o,(function(e){t._tabInput()})),i.on("draw"+o,(function(e){if((t._tabInput(),!t.s.focusDraw)&&t.s.lastFocus){var n=t.s.lastFocus.relative,s=i.page.info(),o=n.row+s.start;if(0===s.recordsDisplay)return;o>=s.recordsDisplay&&(o=s.recordsDisplay-1),t._focus(o,n.column,!0,e)}})),this.c.clipboard&&this._clipboard(),i.on("destroy"+o,(function(){t._blur(!0),i.off(o),e(i.table().body()).off("click"+o,"th, td").off("dblclick"+o,"th, td"),e(n).off("mousedown"+o).off("keydown"+o).off("copy"+o).off("paste"+o)}));var r=i.state.loaded();r&&r.keyTable?i.one("init",(function(){var e=i.cell(r.keyTable);e.any()&&e.focus()})):this.c.focus&&i.cell(this.c.focus).focus()},_blur:function(t){if(this.s.enable&&this.s.lastFocus){var n=this.s.lastFocus.cell;e(n.node()).removeClass(this.c.className),this.s.lastFocus=null,t||(this._updateFixedColumns(n.index().column),this._emitEvent("key-blur",[this.s.dt,n]))}},_clipboard:function(){var i=this.s.dt,s=this,o=this.s.namespace;t.getSelection&&(e(n).on("copy"+o,(function(e){var n=e.originalEvent,i=t.getSelection().toString(),o=s.s.lastFocus;!i&&o&&(n.clipboardData.setData("text/plain",o.cell.render(s.c.clipboardOrthogonal)),n.preventDefault())})),e(n).on("paste"+o,(function(e){var o,l=e.originalEvent,a=s.s.lastFocus,r=n.activeElement,c=s.c.editor;if(a&&(!r||"body"===r.nodeName.toLowerCase()))if(l.preventDefault(),t.clipboardData&&t.clipboardData.getData?o=t.clipboardData.getData("Text"):l.clipboardData&&l.clipboardData.getData&&(o=l.clipboardData.getData("text/plain")),c){var u=s._inlineOptions(a.cell.index());c.inline(u.cell,u.field,u.options).set(c.displayed()[0],o).submit()}else a.cell.data(o),i.draw(!1)})))},_columns:function(){var e=this.s.dt,t=e.columns(this.c.columns).indexes(),n=[];return e.columns(":visible").every((function(e){-1!==t.indexOf(e)&&n.push(e)})),n},_editor:function(t,i,s){if(this.s.lastFocus&&(!i||"draw"!==i.type)){var o=this,a=this.s.dt,r=this.c.editor,c=this.s.lastFocus.cell,u=this.s.namespace+"e"+l++;if(!(e("div.DTE",c.node()).length||null!==t&&(t>=0&&t<=9||11===t||12===t||t>=14&&t<=31||t>=112&&t<=123||t>=127&&t<=159))){i&&(i.stopPropagation(),13===t&&i.preventDefault());var d=function(){var t=o._inlineOptions(c.index());r.one("open"+u,(function(){r.off("cancelOpen"+u),s||e("div.DTE_Field_InputControl input, div.DTE_Field_InputControl textarea").select(),a.keys.enable(s?"tab-only":"navigation-only"),a.on("key-blur.editor",(function(e,t,n){r.displayed()&&n.node()===c.node()&&r.submit()})),s&&e(a.table().container()).addClass("dtk-focus-alt"),r.on("preSubmitCancelled"+u,(function(){setTimeout((function(){o._focus(c,null,!1)}),50)})),r.on("submitUnsuccessful"+u,(function(){o._focus(c,null,!1)})),r.one("close"+u,(function(){a.keys.enable(!0),a.off("key-blur.editor"),r.off(u),e(a.table().container()).removeClass("dtk-focus-alt"),o.s.returnSubmit&&(o.s.returnSubmit=!1,o._emitEvent("key-return-submit",[a,c]))}))})).one("cancelOpen"+u,(function(){r.off(u)})).inline(t.cell,t.field,t.options)};13===t?(s=!0,e(n).one("keyup",(function(){d()}))):d()}}},_inlineOptions:function(e){return this.c.editorOptions?this.c.editorOptions(e):{cell:e,field:i,options:i}},_emitEvent:function(t,n){this.s.dt.iterator("table",(function(i,s){e(i.nTable).triggerHandler(t,n)}))},_focus:function(s,o,l,a){var r=this,c=this.s.dt,u=c.page.info(),d=this.s.lastFocus;if(a||(a=null),this.s.enable){if("number"!=typeof s){if(!s.any())return;var f=s.index();if(o=f.column,(s=c.rows({filter:"applied",order:"applied"}).indexes().indexOf(f.row))<0)return;u.serverSide&&(s+=u.start)}if(-1!==u.length&&(s<u.start||s>=u.start+u.length))return this.s.focusDraw=!0,this.s.waitingForDraw=!0,void c.one("draw",(function(){r.s.focusDraw=!1,r.s.waitingForDraw=!1,r._focus(s,o,i,a)})).page(Math.floor(s/u.length)).draw(!1);if(-1!==e.inArray(o,this._columns())){u.serverSide&&(s-=u.start);var h=c.cells(null,o,{search:"applied",order:"applied"}).flatten(),b=c.cell(h[s]);if(d){if(d.node===b.node())return void this._emitEvent("key-refocus",[this.s.dt,b,a||null]);this._blur()}this._removeOtherFocus();var p=e(b.node());if(p.addClass(this.c.className),this._updateFixedColumns(o),l===i||!0===l){this._scroll(e(t),e(n.body),p,"offset");var y=c.table().body().parentNode;if(y!==c.table().header().parentNode){var v=e(y.parentNode);this._scroll(v,v,p,"position")}}this.s.lastFocus={cell:b,node:b.node(),relative:{row:c.rows({page:"current"}).indexes().indexOf(b.index().row),column:b.index().column}},this._emitEvent("key-focus",[this.s.dt,b,a||null]),c.state.save()}}},_key:function(t){if(this.s.waitingForDraw)t.preventDefault();else{var n=this.s.enable;this.s.returnSubmit=("navigation-only"===n||"tab-only"===n)&&13===t.keyCode;var i=!0===n||"navigation-only"===n;if(n&&(!(0===t.keyCode||t.ctrlKey||t.metaKey||t.altKey)||t.ctrlKey&&t.altKey)){var s=this.s.lastFocus;if(s)if(this.s.dt.cell(s.node).any()){var o=this.s.dt,l=!!this.s.dt.settings()[0].oScroll.sY;if(!this.c.keys||-1!==e.inArray(t.keyCode,this.c.keys))switch(t.keyCode){case 9:this._shift(t,t.shiftKey?"left":"right",!0);break;case 27:this.c.blurable&&!0===n&&this._blur();break;case 33:case 34:i&&!l&&(t.preventDefault(),o.page(33===t.keyCode?"previous":"next").draw(!1));break;case 35:case 36:if(i){t.preventDefault();var a=o.cells({page:"current"}).indexes(),r=this._columns();this._focus(o.cell(a[35===t.keyCode?a.length-1:r[0]]),null,!0,t)}break;case 37:i&&this._shift(t,"left");break;case 38:i&&this._shift(t,"up");break;case 39:i&&this._shift(t,"right");break;case 40:i&&this._shift(t,"down");break;case 113:if(this.c.editor){this._editor(null,t,!0);break}default:!0===n&&this._emitEvent("key",[o,t.keyCode,this.s.lastFocus.cell,t])}}else this.s.lastFocus=null}}},_removeOtherFocus:function(){var t=this.s.dt.table().node();e.fn.dataTable.tables({api:!0}).iterator("table",(function(e){this.table().node()!==t&&this.cell.blur()}))},_scroll:function(e,t,n,i){var s=n[i](),o=n.outerHeight(),l=n.outerWidth(),a=t.scrollTop(),r=t.scrollLeft(),c=e.height(),u=e.width();"position"===i&&(s.top+=parseInt(n.closest("table").css("top"),10)),s.top<a&&t.scrollTop(s.top),s.left<r&&t.scrollLeft(s.left),s.top+o>a+c&&o<c&&t.scrollTop(s.top+o-c),s.left+l>r+u&&l<u&&t.scrollLeft(s.left+l-u)},_shift:function(t,n,i){var s=this.s.dt,o=s.page.info(),l=o.recordsDisplay,a=this._columns(),r=this.s.lastFocus;if(r){var c=r.cell;if(c){var u=s.rows({filter:"applied",order:"applied"}).indexes().indexOf(c.index().row);o.serverSide&&(u+=o.start);var d=s.columns(a).indexes().indexOf(c.index().column),f=u,h=a[d];"rtl"===e(s.table().node()).css("direction")&&("right"===n?n="left":"left"===n&&(n="right")),"right"===n?d>=a.length-1?(f++,h=a[0]):h=a[d+1]:"left"===n?0===d?(f--,h=a[a.length-1]):h=a[d-1]:"up"===n?f--:"down"===n&&f++,f>=0&&f<l&&-1!==e.inArray(h,a)?(t&&t.preventDefault(),this._focus(f,h,!0,t)):i&&this.c.blurable?this._blur():t&&t.preventDefault()}}},_tabInput:function(){var t=this,n=this.s.dt,i=null!==this.c.tabIndex?this.c.tabIndex:n.settings()[0].iTabIndex;if(-1!=i){if(!this.s.tabInput){var s=e('<div><input type="text" tabindex="'+i+'"/></div>').css({position:"absolute",height:1,width:0,overflow:"hidden"});s.children().on("focus",(function(e){var i=n.cell(":eq(0)",t._columns(),{page:"current"});i.any()&&t._focus(i,null,!0,e)})),this.s.tabInput=s}var o=this.s.dt.cell(":eq(0)","0:visible",{page:"current",order:"current"}).node();o&&e(o).prepend(this.s.tabInput)}},_updateFixedColumns:function(e){var t=this.s.dt,n=t.settings()[0];if(n._oFixedColumns){var i=n._oFixedColumns.s.iLeftColumns,s=n.aoColumns.length-n._oFixedColumns.s.iRightColumns;(e<i||e>=s)&&t.fixedColumns().update()}}}),a.defaults={blurable:!0,className:"focus",clipboard:!0,clipboardOrthogonal:"display",columns:"",editor:null,editOnFocus:!1,editorOptions:null,focus:null,keys:null,tabIndex:null},a.version="2.6.4",e.fn.dataTable.KeyTable=a,e.fn.DataTable.KeyTable=a,s.Api.register("cell.blur()",(function(){return this.iterator("table",(function(e){e.keytable&&e.keytable.blur()}))})),s.Api.register("cell().focus()",(function(){return this.iterator("cell",(function(e,t,n){e.keytable&&e.keytable.focus(t,n)}))})),s.Api.register("keys.disable()",(function(){return this.iterator("table",(function(e){e.keytable&&e.keytable.enable(!1)}))})),s.Api.register("keys.enable()",(function(e){return this.iterator("table",(function(t){t.keytable&&t.keytable.enable(e===i||e)}))})),s.Api.register("keys.enabled()",(function(e){var t=this.context;return!!t.length&&(!!t[0].keytable&&t[0].keytable.enabled())})),s.Api.register("keys.move()",(function(e){return this.iterator("table",(function(t){t.keytable&&t.keytable._shift(null,e,!1)}))})),s.ext.selector.cell.push((function(e,t,n){var s=t.focused,o=e.keytable,l=[];if(!o||s===i)return n;for(var a=0,r=n.length;a<r;a++)(!0===s&&o.focused(n[a])||!1===s&&!o.focused(n[a]))&&l.push(n[a]);return l})),e(n).on("preInit.dt.dtk",(function(t,n,i){if("dt"===t.namespace){var o=n.oInit.keys,l=s.defaults.keys;if(o||l){var r=e.extend({},l,o);!1!==o&&new a(n,r)}}})),a}));